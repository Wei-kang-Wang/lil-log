---
layout: post
comments: false
title: "各种系统、平台、环境的安装"
date: 2022-05-01 01:09:00

---

> 这个post是有关各种系统、环境、平台的安装指南。


<!--more-->



---


## Linux系统用Anaconda安装pytorch + CUDA + cuDNN

### 1. 安装Anaconda

从Anaconda官网下载安装所用的的sh文件（比如说Anaconda3-5.3.1-Linux-x86_64.sh），上传至Linux系统。

在Linux系统里打开bash，cd到要上述安装文件所在目录下进行操作 ，然后输入：

```c
bash -u Anaconda3-5.3.1-Linux-x86_64.sh
```

安装成功后，输入：

```c
source ~/.bashrc
```

到此Anaconda安装成功。可以通过下面代码检查是否安装成功：

```c
python
```

显示下面的样子，则说明安装正确：

![pic1]({{ '/assets/images/install-1.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

输入下面指令退出：

```c
quit()
```

### 2. 了解操作系统内核、显卡、编译器等基本信息

#### 2.1 查看自己操作系统的版本信息

```c
cat /etc/issue
```

或者

```c
cat /etc/lsb-release
```

![pic2]({{ '/assets/images/install-2.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

![pic3]({{ '/assets/images/install-3.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

#### 2.2 查看服务器显卡信息

```c
lspci | grep -i nvidia
```
用于查看全部的显卡信息。

![pic4]({{ '/assets/images/install-4.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

如果已经安装了显卡驱动，则可以用下述指令查看：

```c
nvidia-smi
```
![pic5]({{ '/assets/images/install-5.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

#### 2.3 查看安装的显卡驱动的信息

```c
cat /proc/driver/nvidia/version
```

![pic6]({{ '/assets/images/install-6.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

### 3. 显卡驱动安装

如果要安装显卡驱动，需要根据操作系统的版本进行选择。

#### 3.1 多版本的gcc和g++

gcc和g++是很多驱动安装过程中需要使用的编译器，很多时候由于编译器版本的不对应会使得安装出现很多莫民奇妙的错误，根据经验，现在的CUDA 10.1的话，也可以使用的是4.8，因此最好选择4.8-5.4之间的版本比较好，

首先查看系统的gcc和g++版本：

```c
gcc --version
g++ --version
```

![pic7]({{ '/assets/images/install-7.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

之后安装新版本的gcc以及g++：

```c
sudo apt-get update 
sudo apt get update                                                        /*对需要的软件包等进行必要的更新。*/
sudo apt-get install gcc-4.9
sudo apt-get install g++-4.9                                               /*用于安装对应版本的gcc以及g++。注意自己需要的版本自己修改。*/
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 20
sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 20

/*这两行用于将刚安装的gcc和g++类似于注册的操作加入到bin中，用于可选择操作。也就是说通过这个操作不断向系统注册新的gcc和g++版本。*/

update-alternatives --config gcc
update-alternatives --config g++                                           /*用于对版本进行选择。进入之后根据提示完成选择即可。如果权限不够加sudo */
```

![pic8]({{ '/assets/images/install-8.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

一般我们是使用4.8-5.4之间的版本编译器即可。如果还是出现错误的话，首选的操作应该是卸载显卡驱动重装显卡驱动，成功率最高。

#### 3.2 显卡驱动安装

如果需要安装显卡驱动的话，需要先将旧版本的显卡驱动卸载：

```c
sudo apt-get remove --purge nvidia*
```

此外，安装之前，需要先禁用一个东西。nouveau。

打开文件blacklist.conf：

```c
sudo vim /etc/modprobe.d/blacklist.conf
```

在文件的最后面加入以下的内容:

```c
blacklist nouveau
blacklist lbm-nouveau
options nouveau modeset=0
alias nouveau off
alias lbm-nouveau off
```

检查操作是否成功：

```c
lsmod | grep nouveau   /* 没显示即成功。 */
```

显卡驱动的安装比较简单，直接到官网进行对应的驱动的下载。

![pic9]({{ '/assets/images/install-9.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

![pic10]({{ '/assets/images/install-10.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

将下载好的显卡驱动上传到服务器进行安装。

![pic11]({{ '/assets/images/install-11.png' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

采用该命令进行驱动的安装：

```c
sudo ./NVIDIA-Linux-x86_64-430.34.run
```

安装完成之后，可以采用以下命令进行检查：

```c
nvidia-smi
```

### 4. CUDA及cuDNN的安装

CUDA是GPU进行计算的运算平台，根据需要安装对应版本的cuda。

这里需要注意的是，最好在安装显卡驱动的时候选择对应的cuda版本，然后在安装cuda的时候的版本保持一致（虽然高版本的驱动也可以兼容低版本的cuda）。

首先，查看自己的显卡驱动版本以及支持的最大CUDA版本：

```c
nvidia-smi
```

![pic12]({{ '/assets/images/install-12.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

进入英伟达提供的[GPU驱动和CUDA对应关系](https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html)

确认自己目前的GPU驱动是否符合自己要安装的CUDA版本，符合就进入下一步，不符合就安装更加高级的驱动。

#### 4.1 CUDA安装包下载

[这是最新版本的CUDA下载界面](https://developer.nvidia.com/cuda-downloads)
[这是之前版本的CUDA下载界面](https://developer.nvidia.com/cuda-toolkit-archive)

以CUDA-10.2为例：

![pic13]({{ '/assets/images/install-13.PNG' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

利用下述代码下载CUDA并安装：

```c
wget https://developer.download.nvidia.com/compute/cuda/10.2/Prod/local_installers/cuda_10.2.89_440.33.01_linux.run
sudo sh cuda_10.2.89_440.33.01_linux.run
```

也可以选择在浏览器中输入wget后面的网址，然后在本地进行下载再上传至服务器。

#### 4.2 cuDNN安装包下载

通过[网址](https://developer.nvidia.com/rdp/cudnn-download)下载CUDNN，下载需要注册账号，登录以后，如下图选择合适的CUDA版本对应的CUDNN并选择CUDNN Library for Linux，开始下载，下载好以后将文件后缀名改为.tgz后上传至服务器。

![pic14]({{ '/assets/images/install-14.PNG' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

![pic15]({{ '/assets/images/install-15.PNG' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

注意Archived cuDNN Releases就可以找到过去版本的cudnn。


#### 4.3 CUDA的安装（非root用户安装）

先给cuda可执行权限：

```c
chmod +x cuda_10.2.89_440.33.01_linux.run
```

运行run文件:

```c
sh cuda_10.2.89_440.33.01_linux.run
```

通过键盘方向键（↑，↓）和Enter键可以进行选择和进入（确定）。选择Continue并进入:

![pic16]({{ '/assets/images/install-16.PNG' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

输入accept进入:

![pic17]({{ '/assets/images/install-17.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

利用上下键与Enter勾选对话框，只安装CUDA Toolkit:

![pic18]({{ '/assets/images/install-18.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

选择Options并进入，然后我们需要修改Toolkit Options 、Library install path这两项的路径。

![pic19]({{ '/assets/images/install-19.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

修改Toolkit Options路径，选择Change Toolkit Install Path:

![pic20]({{ '/assets/images/install-20.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

将默认路径修改至个人目录下，点击Enter确认:

![pic21]({{ '/assets/images/install-21.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

将下面的选项取消选定，选择Done，确认退出:

![pic22]({{ '/assets/images/install-22.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

选择Library install path （Blank for system default）

![pic23]({{ '/assets/images/install-23.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

添加之前一样的路径并Enter确认退出

![pic24]({{ '/assets/images/install-24.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

选择Done返回上一层目录，修改路径完成，选择Install开始安装

![pic25]({{ '/assets/images/install-25.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

出现如下所示的安装信息则说明安装成功

![pic26]({{ '/assets/images/install-26.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

#### 4.4 修改环境变量

输入vim ~/.bashrc进行环境变量的修改；
添加一下信息（每个人的路径是不同的，我的是/home/zhaoqc/cuda-10.2）并保存退出。

```c
export CUDA_HOME=$CUDA_HOME:/home/zhaoqc/cuda-10.2
export PATH=$PATH:/home/zhaoqc/cuda-10.2/bin
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/zhaoqc/cuda-10.2/lib64
```

输入source ~/.bashrc

#### 4.5 安装cuDNN

解压cuDNN，输入以下命令进行解压

```c
tar -zxvf cudnn-10.2-linux-x64-v8.0.0.39.tgz
```

此时当前目录下回出现一个./cuda的文件夹

![pic27]({{ '/assets/images/install-27.PNG' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

复制文件到CUDA安装目录

```c
cp cuda/include/cudnn.h ../cuda-10.2/include/
cp cuda/lib64/libcudnn* ../cuda-10.2/lib64/
```

修改权限，cudnn安装完成

```c
chmod a+r ../cuda-10.2/include/cudnn.h ../cuda-10.2/lib64/libcudnn*
```

查看是否安装成功，输入nvcc -V

![pic28]({{ '/assets/images/install-28.jpg' | relative_url }})
{: style="width: 800px; max-width: 100%;"}


### 5. 安装PyTorch

现在Anaconda里构建一个虚拟环境：

```c
conda create -n pytorch_env python=3.8
```

上述指令会生成一个叫pytorch_env的虚拟环境，相当于在Anaconda里开了个小房间，我们之后的包都可以在这个地方安装，即使有问题也不会影响其它的小房间以及Anaconda，而且可以很容易删除，注意上述指令还强调了我们用的是python3.8环境。

安装完成之后，输入conda activate pytorch_env进入虚拟环境。下图里左边的括号内的名字就是环境的名字，请确认切换到pytorch_env这个名字的环境后再继续安装pytorch。

![pic29]({{ '/assets/images/install-29.PNG' | relative_url }})
{: style="width: 800px; max-width: 100%;"}

#### 6. 常用conda命令

新建一个Pyhon版本为3.8的环境

```c
conda create -n name_of_environment python=3.8
```

删除掉一个环境

```c
conda remove -n name_of_environment –all
```

查看安装了的环境

```c
conda info –envs
```

安装一个软件

```c
conda install some_package
```

查看当前环境装了哪些软件

```c
conda list
```

复制一个环境并重新命名（老环境不会删除）

```c
conda create –name new_name –clone old_name
```

清理包缓存

```c
conda clean -p
```

清理tar包缓存

```c
conda clean -t
```

### 6. 参考文献
* https://zhuanlan.zhihu.com/p/198161777
* https://blog.csdn.net/kingfoulin/article/details/98872965
* https://panpili.com/?p=1166
* https://blog.csdn.net/weixin_44100850/article/details/103308367


## Linux安装tmux

tmux是一个 terminal multiplexer（终端复用器），它可以启动一系列终端会话。

简单来说，安装tmux之前，一旦与服务器断开连接或者关闭xhell或其他shell终端，我们的服务器上运行的程序就会终止，而且输入的历史消息全部消失。因此如果我们希望整晚在服务器上跑代码，我们的电脑也要整晚一直连接着服务器。而安装了tmux之后，即使我们关闭了shell终端或者不幸与服务器断开连接，我们在服务器上的程序依然在运行。

### 1. 有sudo权限的用户

很简单，就一行：

```c
sudo apt-get install tmux
```

### 2. 无sudo权限的非root用户

#### 2.1 下载

下载tmux及其依赖软件。

```c
wget -c https://github.com/tmux/tmux/releases/download/3.0a/tmux-3.0a.tar.gz
wget -c https://github.com/libevent/libevent/releases/download/release-2.1.11-stable/libevent-2.1.11-stable.tar.gz
wget -c https://ftp.gnu.org/gnu/ncurses/ncurses-6.2.tar.gz
```

#### 2.2 解压下载的包

```c
tar -xzvf tmux-3.0a.tar.gz
tar -xzvf libevent-2.1.11-stable.tar.gz
tar -xzvf ncurses-6.2.tar.gz
```

#### 2.3 分别源码安装，先安装两个依赖包

libevent会安在 /tmux_depend/lib：

```c
cd  libevent-2.1.11-stable
# $HOME/tmux_depend是我的安装路径，大家可以修改
./configure --prefix=$HOME/tmux_depend --disable-shared
make && make install
```

ncurses会安在 /tmux_depend/include：

```c
cd
cd  ncurses-6.2
./configure --prefix=$HOME/tmux_depend
make && make install
```

#### 2.4 安装tmux

```c
cd
cd  tmux-3.0a
./configure CFLAGS="-I$HOME/tmux_depend/include -I/$HOME/tmux_depend/include/ncurses" LDFLAGS="-L/$HOME/tmux_depend/lib -L/$HOME/tmux_depend/include/ncurses -L/$HOME/tmux_depend/include"
make
cp tmux  $HOME/tmux_depend/bin
```

#### 2.5 设置环境变量（此步骤建议手动添加到bashrc文件中）

```c
export PATH=$HOME/tmux_depend/bin:$PATH
source ~/.bashrc
```

到此即完成安装


### 3. tmux常见指令以及用法

```c
1）新建会话，比如新创建一个会话以"ccc"命名
 
[root@Centos6 ~]# tmux new -s ccc
 
 
 
加上参数-d，表示在后台新建会话
 
root@bobo:~# tmux new -s shibo -d
 
root@bobo:~# tmux ls
 
shibo: 1 windows (created Tue Oct  2 19:22:32 2018) [135x35]
 
 
 
2）查看创建得所有会话
 
[root@Centos6 ~]# tmux ls
 
0: 1 windows (created Wed Aug 30 17:58:20 2017) [112x22](attached)    #这里的attached表示该会话是当前会话
 
aaa: 2 windows (created Wed Aug 30 16:54:33 2017) [112x22]
 
ccc: 1 windows (created Wed Aug 30 17:01:05 2017) [112x22]
 
   
 
3）登录一个已知会话。即从终端环境进入会话。
 
第一个参数a也可以写成attach。后面的aaa是会话名称。
 
[root@Centos6 ~]# tmux a -t aaa 
 
　　
 
4）退出会话不是关闭：
 
登到某一个会话后，先按键ctrl+b启动快捷键，再按d，这样就会退出该会话，但不会关闭会话。
 
如果直接ctrl + d，就会在退出会话的通话也关闭了该会话！
 
   
 
5）关闭会话（销毁会话）
 
[root@Centos6 ~]# tmux ls
 
aaa: 2 windows (created Wed Aug 30 16:54:33 2017) [112x22]
 
bbb: 1 windows (created Wed Aug 30 19:02:09 2017) [112x22]
 
   
 
[root@Centos6 ~]# tmux kill-session -t bbb
 
   
 
[root@Centos6 ~]# tmux ls
 
aaa: 2 windows (created Wed Aug 30 16:54:33 2017) [112x22]
 
  
 
6）重命名会话
 
[root@Centos6 ~]# tmux ls  
 
wangshibo: 1 windows (created Sun Sep 30 10:17:00 2018) [136x29] (attached)
 
  
 
[root@Centos6 ~]# tmux rename -t wangshibo kevin
 
  
 
[root@Centos6 ~]# tmux ls
 
kevin: 1 windows (created Sun Sep 30 10:17:00 2018) [136x29] (attached)
```






#### 3. 参考文献：
* https://zhuanlan.zhihu.com/p/155662601















